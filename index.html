<script>
  const dropArea = document.getElementById('drop-area');
  const fileInput = document.getElementById('fileElem');
  const gallery = document.getElementById('gallery');
  const imageCount = document.getElementById('image-count');
  const maxImages = 5;

  function updateCounter() {
    imageCount.textContent = `${gallery.children.length} / ${maxImages} immagini caricate`;
  }

  function showLimitWarning() {
    alert("⚠️ Limite raggiunto: puoi caricare fino a 5 immagini.");
  }

  function handleFiles(files) {
    const existingCount = gallery.children.length;
    if (existingCount + files.length > maxImages) {
      showLimitWarning();
      return;
    }

    for (const file of files) {
      if (!file.type.startsWith("image/")) continue;

      const reader = new FileReader();
      reader.onload = () => {
        const container = document.createElement('div');
        container.className = 'image-preview';

        const img = document.createElement('img');
        img.src = reader.result;

        const closeBtn = document.createElement('button');
        closeBtn.textContent = '❌';
        closeBtn.className = 'remove-btn';
        closeBtn.onclick = () => {
          gallery.removeChild(container);
          updateCounter();
        };

        container.appendChild(img);
        container.appendChild(closeBtn);
        gallery.appendChild(container);
        updateCounter();
      };
      reader.readAsDataURL(file);
    }
  }

  dropArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropArea.classList.add('highlight');
  });

  dropArea.addEventListener('dragleave', () => {
    dropArea.classList.remove('highlight');
  });

  dropArea.addEventListener('drop', (e) => {
    e.preventDefault();
    dropArea.classList.remove('highlight');
    handleFiles(e.dataTransfer.files);
  });

  fileInput.addEventListener('change', () => {
    handleFiles(fileInput.files);
  });

  updateCounter();
</script>
